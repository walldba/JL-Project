<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <!--<meta charset="utf-8" />-->
    <title></title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">
        var dataParam = {
            "sEcho": "4",
            "iDisplayStart": "0",
            "iDisplayLength": "10000",
            "iSortCol_0": "1",
            "sSortDir_0": "asc",
            "sSearch": "",
            "TypeBind": "cot",
            "MarketID": "0",
            "SectorID": "0"
        };
        $(document).ready(function () {
            jQuery.support.cors = true;
            //// chamar api via post
            $.ajax({
                headers: {
                    'Access-Control-Allow-Credentials': '*',
                    'Access-Control-Allow-Origin': '*',
                    'Access-Control-Allow-Headers': 'Content-Type',
                    'Access-Control-Allow-Methods': 'POST',
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Credentials': true
                },
                crossDomain: true,
                contentType: 'application/json',
                data: JSON.stringify(dataParam),
                //dataType: 'json',
                success: function (data) {
                    console.log("device control succeeded");
                },
                error: function (er) {
                    console.log("Device control failed");
                    console.log(er);
                },
                processData: false,
                type: 'POST',
                url: 'https://www.infomoney.com.br/webservices/services.asmx/GetStockSearchData'
            });

            //$.ajax({
            //    url: "https://www.infomoney.com.br/webservices/services.asmx/GetStockSearchData?hash=cfcd208495d565ef66e7dff9f98764da",
            //    headers: {
            //        'Access-Control-Allow-Credentials': '*',
            //        'Access-Control-Allow-Origin': '*',
            //        'Access-Control-Allow-Headers': 'Content-Type',
            //        'Content-Type': 'application/json',
            //        'hash': 'cfcd208495d565ef66e7dff9f98764da'
            //    },
            //    method: "POST",
            //    //crossDomain: true,
            //    // This is the important part
            //    //xhrFields: {
            //        //withCredentials: true
            //    //},
            //    contentType: 'application/json; charset=utf-8',
            //    // This is the important part
            //    data: JSON.stringify({"sEcho": 4, "iDisplayStart": 0, "iDisplayLength": 10000,"iSortCol_0": 1, "sSortDir_0": "asc", "sSearch": "","TypeBind": "cot", "MarketID": "0", "SectorID": "0"}),
            //    dataType: 'json',
            //    beforeSend: function (xhr) {
            //        xhr.setRequestHeader('hash', 'cfcd208495d565ef66e7dff9f98764da');
            //        xhr.setRequestHeader('Access-Control-Allow-Credentials', '*');
            //        xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
            //        xhr.setRequestHeader('Access-Control-Allow-Headers', 'Content-Type');
            //        xhr.setRequestHeader('Content-Type', 'application/json');
            //    },
            //    success: function (response) {
            //        // handle the response
            //        alert("Data Loaded: " + data);
            //    },
            //    error: function (xhr, status) {
            //        // handle errors
            //    }
            //});

            //var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance
            //xmlhttp.open("POST", "https://www.infomoney.com.br/webservices/services.asmx/GetStockSearchData?hash=cfcd208495d565ef66e7dff9f98764da");
            //xmlhttp.setRequestHeader("Content-Type", "application/json");
            //xmlhttp.setRequestHeader("Access-Control-Allow-Origin", "*");
            //xmlhttp.setRequestHeader("Access-Control-Allow-Methods", "GET, POST, PUT");
            //xmlhttp.setRequestHeader("Access-Control-Allow-Headers", "Content-Type");
            //xmlhttp.setRequestHeader("Access-Control-Max-Age", "1728000");
            //xmlhttp.withCredentials = true;
            //xmlhttp.send(
            //    JSON.stringify({
            //    "sEcho": 4, "iDisplayStart": 0, "iDisplayLength": 10000, "iSortCol_0": 1, "sSortDir_0": "asc", "sSearch": "", "TypeBind": "cot", "MarketID": "0", "SectorID": "0"
            //    })
            //);

            //$.post("https://www.infomoney.com.br/webservices/services.asmx/GetStockSearchData?hash=cfcd208495d565ef66e7dff9f98764da",
            //    { "sEcho": 4, "iDisplayStart": 0, "iDisplayLength": 10000, "iSortCol_0": 1, "sSortDir_0": "asc", "sSearch": "", "TypeBind": "cot", "MarketID": "0", "SectorID": "0" }
            //)
            //    .done(function (data) {
            //        alert("Data Loaded: " + data);
            //});
        });
    </script>
</head>
<body>
    <table>
        <thead>
            <tr>
                <td>Nome ação</td>
                <td>Código Ação</td>
                <td>Data</td>
                <td>Valor atual</td>
                <td>Variacão dia %</td>
                <td>Variacão Semana %</td>
                <td>Variacão Mensal %</td>
                <td>Variacão Ano %</td>
            </tr>
        </thead>
        <tbody id="corpoAPIAcoes"></tbody>
    </table>
</body>
</html>
